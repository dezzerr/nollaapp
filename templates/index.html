{% extends "base.html" %}

{% block content %}
<div class="p-8 max-w-7xl mx-auto">
    <!-- Header Section -->
    <div class="flex justify-between items-center mb-8">
        <div>
            <h1 class="text-3xl font-bold text-primary">Welcome, {{ user_name.split()[0] }}</h1>
            <p class="text-gray-600 mt-1">Let's start a new transcription session</p>
        </div>
        <div class="flex items-center space-x-4">
            <button id="newSessionBtn" class="bg-accent hover:bg-accent/90 text-primary px-6 py-3 rounded-xl flex items-center space-x-3 shadow-sm transition-all duration-200">
                <i class="fas fa-plus"></i>
                <span class="font-medium">New Session</span>
            </button>
            <button id="downloadNotesBtn" class="bg-white hover:bg-gray-50 text-primary border border-gray-200 px-6 py-3 rounded-xl flex items-center space-x-3 shadow-sm transition-all duration-200">
                <i class="fas fa-download"></i>
                <span class="font-medium">Download Notes</span>
            </button>
        </div>
    </div>

    <!-- Patient Info Card -->
    <div class="bg-white rounded-2xl shadow-sm mb-8 p-6">
        <div class="flex justify-between items-center">
            <div class="space-y-2">
                <input type="text" id="patientName" 
                       class="text-2xl font-semibold text-primary focus:outline-none focus:ring-2 focus:ring-accent/50 rounded-lg px-2 py-1" 
                       placeholder="Enter Patient Name">
                <p class="text-sm text-gray-500 flex items-center space-x-2">
                    <i class="fas fa-user-circle"></i>
                    <span>Patient ID: NOL-2023-001</span>
                </p>
            </div>
            <div class="flex items-center space-x-4">
                <div class="text-sm text-gray-500">Session Date:</div>
                <input type="date" id="sessionDate" 
                       class="border-gray-200 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-accent/50">
            </div>
        </div>
    </div>

    <!-- Recording Section -->
    <div class="bg-white rounded-2xl shadow-sm overflow-hidden">
        <!-- Recording Controls -->
        <div class="border-b border-gray-100 p-6">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-6">
                    <button id="recordButton" 
                            class="bg-primary hover:bg-primary/90 text-white px-6 py-3 rounded-xl flex items-center space-x-3 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
                            disabled>
                        <i class="fas fa-microphone"></i>
                        <span class="font-medium">Start Recording</span>
                    </button>
                    <span id="timer" class="text-xl font-mono text-primary">0:00</span>
                    <div id="recordingStatus" class="hidden flex items-center">
                        <span class="w-3 h-3 bg-red-500 rounded-full animate-pulse"></span>
                        <span class="text-sm text-gray-600 ml-2">Recording...</span>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="consentToggle" class="sr-only peer">
                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-accent/50 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-accent"></div>
                        <span class="text-sm text-gray-600 ml-2">Patient Consent</span>
                    </label>
                </div>
            </div>
        </div>

        <!-- Tab Navigation -->
        <div class="border-b border-gray-100">
            <nav class="flex justify-between items-center px-6" aria-label="Tabs">
                <div class="flex space-x-6">
                    <button id="transcriptTab" 
                            class="px-4 py-4 text-sm font-medium text-gray-500 border-b-2 border-transparent hover:text-primary hover:border-accent transition-all duration-200">
                        <span class="flex items-center space-x-2">
                            <i class="fas fa-file-alt"></i>
                            <span>Transcript</span>
                        </span>
                    </button>
                    <button id="notesTab" 
                            class="px-4 py-4 text-sm font-medium text-gray-500 border-b-2 border-transparent hover:text-primary hover:border-accent transition-all duration-200">
                        <span class="flex items-center space-x-2">
                            <i class="fas fa-notes-medical"></i>
                            <span>Notes</span>
                        </span>
                    </button>
                    <button id="letterTab" 
                            class="px-4 py-4 text-sm font-medium text-gray-500 border-b-2 border-transparent hover:text-primary hover:border-accent transition-all duration-200">
                        <span class="flex items-center space-x-2">
                            <i class="fas fa-envelope"></i>
                            <span>Letter</span>
                        </span>
                    </button>
                </div>
                <div class="flex items-center space-x-3">
                    <label class="text-sm text-gray-600">Template:</label>
                    <select id="templateSelect" 
                            class="border border-gray-200 rounded-lg px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-accent/50">
                        <option value="soap">SOAP Note</option>
                        <option value="birp">BIRP Note</option>
                        <option value="dap">DAP Note</option>
                        <option value="basic">Basic Note</option>
                    </select>
                </div>
            </nav>
        </div>

        <!-- Content Panels -->
        <div class="min-h-[400px] p-6">
            <!-- Transcript Panel -->
            <div id="transcriptPanel" class="h-full">
                <div id="loadingTranscription" class="hidden space-y-4">
                    <div class="h-4 bg-gray-200 rounded animate-pulse"></div>
                    <div class="h-4 bg-gray-200 rounded animate-pulse w-5/6"></div>
                    <div class="h-4 bg-gray-200 rounded animate-pulse w-4/6"></div>
                </div>
                <div id="transcriptionOutput" class="space-y-4"></div>
            </div>

            <!-- Notes Panel -->
            <div id="notesPanel" class="hidden space-y-6 p-6 bg-white rounded-xl shadow-lg">
                <div class="space-y-4">
                    <div class="flex justify-between items-center">
                        <h2 class="text-2xl font-semibold text-gray-800">Clinical Notes</h2>
                        <div class="space-x-2">
                            <button id="generateNotesBtn" 
                                    class="bg-accent hover:bg-accent/90 text-white px-4 py-2 rounded-lg transition-colors">
                                <i class="fas fa-magic mr-2"></i>Generate Notes
                            </button>
                            <button id="saveNotesBtn" 
                                    class="bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-lg transition-colors">
                                <i class="fas fa-save mr-2"></i>Save Notes
                            </button>
                        </div>
                    </div>

                    <!-- SOAP Note Template -->
                    <div id="soapTemplate" class="space-y-6">
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-gray-700">Subjective</label>
                            <textarea id="subjectiveText" 
                                    class="w-full h-32 border border-gray-200 rounded-xl p-4 focus:outline-none focus:ring-2 focus:ring-accent/50"
                                    placeholder="Patient's reported symptoms, concerns, and history..."></textarea>
                        </div>
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-gray-700">Objective</label>
                            <textarea id="objectiveText" 
                                    class="w-full h-32 border border-gray-200 rounded-xl p-4 focus:outline-none focus:ring-2 focus:ring-accent/50"
                                    placeholder="Observable findings and measurements..."></textarea>
                        </div>
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-gray-700">Assessment</label>
                            <textarea id="assessmentText" 
                                    class="w-full h-32 border border-gray-200 rounded-xl p-4 focus:outline-none focus:ring-2 focus:ring-accent/50"
                                    placeholder="Clinical assessment and diagnoses..."></textarea>
                        </div>
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-gray-700">Plan</label>
                            <textarea id="planText" 
                                    class="w-full h-32 border border-gray-200 rounded-xl p-4 focus:outline-none focus:ring-2 focus:ring-accent/50"
                                    placeholder="Treatment plan and next steps..."></textarea>
                        </div>
                    </div>

                    <!-- BIRP Note Template -->
                    <div id="birpTemplate" class="space-y-6 hidden">
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-gray-700">Behavior</label>
                            <textarea id="behaviorText" 
                                    class="w-full h-32 border border-gray-200 rounded-xl p-4 focus:outline-none focus:ring-2 focus:ring-accent/50"
                                    placeholder="Document client's presentation and behavior during the session..."></textarea>
                        </div>
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-gray-700">Intervention</label>
                            <textarea id="interventionText" 
                                    class="w-full h-32 border border-gray-200 rounded-xl p-4 focus:outline-none focus:ring-2 focus:ring-accent/50"
                                    placeholder="Document interventions and themes explored during the session..."></textarea>
                        </div>
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-gray-700">Response</label>
                            <textarea id="responseText" 
                                    class="w-full h-32 border border-gray-200 rounded-xl p-4 focus:outline-none focus:ring-2 focus:ring-accent/50"
                                    placeholder="Document how the client responded to interventions..."></textarea>
                        </div>
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-gray-700">Plan</label>
                            <textarea id="birpPlanText" 
                                    class="w-full h-32 border border-gray-200 rounded-xl p-4 focus:outline-none focus:ring-2 focus:ring-accent/50"
                                    placeholder="Document plan for future sessions..."></textarea>
                        </div>
                    </div>

                    <!-- DAP Note Template -->
                    <div id="dapTemplate" class="space-y-6 hidden">
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-gray-700">Data</label>
                            <textarea id="dataText" 
                                    class="w-full h-32 border border-gray-200 rounded-xl p-4 focus:outline-none focus:ring-2 focus:ring-accent/50"
                                    placeholder="Document objective and subjective observations..."></textarea>
                        </div>
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-gray-700">Assessment</label>
                            <textarea id="dapAssessmentText" 
                                    class="w-full h-32 border border-gray-200 rounded-xl p-4 focus:outline-none focus:ring-2 focus:ring-accent/50"
                                    placeholder="Document clinical interpretation and assessment..."></textarea>
                        </div>
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-gray-700">Plan</label>
                            <textarea id="dapPlanText" 
                                    class="w-full h-32 border border-gray-200 rounded-xl p-4 focus:outline-none focus:ring-2 focus:ring-accent/50"
                                    placeholder="Document treatment plan and next steps..."></textarea>
                        </div>
                    </div>

                    <!-- Basic Note Template -->
                    <div id="basicTemplate" class="space-y-6 hidden">
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-gray-700">Presentation</label>
                            <textarea id="presentationText" 
                                    class="w-full h-32 border border-gray-200 rounded-xl p-4 focus:outline-none focus:ring-2 focus:ring-accent/50"
                                    placeholder="Document client's presentation and appearance..."></textarea>
                        </div>
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-gray-700">Mental State</label>
                            <textarea id="stateText" 
                                    class="w-full h-32 border border-gray-200 rounded-xl p-4 focus:outline-none focus:ring-2 focus:ring-accent/50"
                                    placeholder="Document mental state and mood observations..."></textarea>
                        </div>
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-gray-700">Assessment</label>
                            <textarea id="basicAssessmentText" 
                                    class="w-full h-32 border border-gray-200 rounded-xl p-4 focus:outline-none focus:ring-2 focus:ring-accent/50"
                                    placeholder="Document clinical assessment and diagnoses..."></textarea>
                        </div>
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-gray-700">Plan</label>
                            <textarea id="basicPlanText" 
                                    class="w-full h-32 border border-gray-200 rounded-xl p-4 focus:outline-none focus:ring-2 focus:ring-accent/50"
                                    placeholder="Document treatment plan and recommendations..."></textarea>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex justify-end space-x-2 pt-4">
                    </div>
                </div>
            </div>

            <!-- Letter Panel -->
            <div id="letterPanel" class="hidden space-y-6 p-6 bg-white rounded-xl shadow-lg">
                <div class="space-y-4">
                    <h2 class="text-2xl font-semibold text-gray-800">Clinical Letter Generation</h2>
                    
                    <!-- Letter Request Input -->
                    <div class="space-y-2">
                        <label for="letterRequest" class="block text-sm font-medium text-gray-700">
                            Letter Request
                        </label>
                        <textarea id="letterRequest" 
                                class="w-full h-32 border border-gray-200 rounded-xl p-4 focus:outline-none focus:ring-2 focus:ring-accent/50"
                                placeholder="Describe what kind of letter you need (e.g., 'Generate a referral letter to a cardiologist based on today's consultation')"></textarea>
                    </div>

                    <!-- Generate Button -->
                    <button id="generateLetterBtn" 
                            class="w-full bg-accent hover:bg-accent/90 text-white font-medium py-2 px-4 rounded-lg transition-colors">
                        Generate Letter
                    </button>

                    <!-- Letter Output -->
                    <div id="letterOutputContainer" class="hidden space-y-4">
                        <div class="flex justify-between items-center">
                            <h3 class="text-lg font-medium text-gray-800">Generated Letter</h3>
                            <div class="space-x-2">
                                <button id="copyLetterBtn" 
                                        class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg transition-colors disabled:opacity-50"
                                        disabled>
                                    <i class="fas fa-copy mr-2"></i>Copy
                                </button>
                                <button id="downloadLetterBtn" 
                                        class="bg-accent hover:bg-accent/90 text-white px-4 py-2 rounded-lg transition-colors disabled:opacity-50"
                                        disabled>
                                    <i class="fas fa-download mr-2"></i>Download PDF
                                </button>
                            </div>
                        </div>
                        <textarea id="letterOutput" 
                                class="w-full h-96 border border-gray-200 rounded-xl p-4 focus:outline-none focus:ring-2 focus:ring-accent/50"
                                readonly></textarea>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="{{ url_for('static', filename='js/app.js') }}"></script>
{% endblock %}